<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/yjq.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/yjq.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="eD5NHy4QQsmjI9we">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xiaoq-sd.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="XiaoQ&#39;s Blog">
<meta property="og:url" content="https://xiaoq-sd.github.io/index.html">
<meta property="og:site_name" content="XiaoQ&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Yang Jiaqi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://xiaoq-sd.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>XiaoQ's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">XiaoQ's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xiaoq-sd.github.io/2021/08/21/null/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/yjq.jpg">
      <meta itemprop="name" content="Yang Jiaqi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoQ's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/21/null/" class="post-title-link" itemprop="url">Python学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-21 20:07:30 / 修改时间：20:10:25" itemprop="dateCreated datePublished" datetime="2021-08-21T20:07:30+08:00">2021-08-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> Python学习笔记</p>
<p>基础篇</p>
<p>内容仍待补充</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/08/21/null/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xiaoq-sd.github.io/2021/05/27/DataVisualization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/yjq.jpg">
      <meta itemprop="name" content="Yang Jiaqi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoQ's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/27/DataVisualization/" class="post-title-link" itemprop="url">数据可视化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-27 21:09:03" itemprop="dateCreated datePublished" datetime="2021-05-27T21:09:03+08:00">2021-05-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-21 20:17:54" itemprop="dateModified" datetime="2021-08-21T20:17:54+08:00">2021-08-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="常见可视化模型"><a href="#常见可视化模型" class="headerlink" title="常见可视化模型"></a>常见可视化模型</h2><h3 id="简单条形图（Bar-Chart）"><a href="#简单条形图（Bar-Chart）" class="headerlink" title="简单条形图（Bar Chart）"></a>简单条形图（Bar Chart）</h3><p>效果图：<br><img src="https://img-blog.csdnimg.cn/20200308205515144.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>（图中箭头出表示鼠标位置，交互显示位置处的矩形）</p>
<p>完整代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    w *= <span class="number">0.98</span>;</span><br><span class="line">    h *= <span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> svg = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, w)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">        a[i] = <span class="built_in">Math</span>.random() * <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    svg.selectAll(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .data(a)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> i * (w / a.length);</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> h - d;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, (w / a.length - <span class="number">10</span>))</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> d;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;rgba(0,&#x27;</span> + (<span class="number">200</span> - d) + <span class="string">&#x27;,0,0.8)&#x27;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">&quot;mouseover&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            d3.select(<span class="built_in">this</span>)</span><br><span class="line">                .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;blue&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">&quot;mouseout&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            d3.select(<span class="built_in">this</span>)</span><br><span class="line">                .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;rgba(0,&#x27;</span> + (<span class="number">200</span> - d) + <span class="string">&#x27;,0,0.8)&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>代码解释：</p>
<p>rect元素：d3在svg中绘制矩形的元素</p>
<p>.attr() 设置属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i * (w / a.length);</span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> h - d;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>分别设置每个矩形左上点坐标(x,y)的x值和y值。</p>
<p>要注意选中的画布的左上角坐标是(0,0)，为了使矩形画到画面的下方，y值不能直接引用d的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&quot;width&quot;</span>, (w / a.length - <span class="number">10</span>))</span><br><span class="line">.attr(<span class="string">&quot;height&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>设置每个矩形的宽和长。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;rgba(0,&#x27;</span> + (<span class="number">200</span> - d) + <span class="string">&#x27;,0,0.8)&#x27;</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>填充每个矩形的颜色。</p>
<p>rgba即是 Red + Green + Blue + Alpha。红色值 + 绿色值 + 蓝色值 + 透明度。前三项的值取值范围是0 ~ 255（十六进制0xFF）。透明度取值0 ~ 1。</p>
<p>注意出现变量时的格式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.on(<span class="string">&quot;mouseover&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    d3.select(<span class="built_in">this</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;blue&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.on(<span class="string">&quot;mouseout&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    d3.select(<span class="built_in">this</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;rgba(0,&#x27;</span> + (<span class="number">200</span> - d) + <span class="string">&#x27;,0,0.8)&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>交互部分，设置该矩形在移入鼠标时的行为和移出后的行为。</p>
<h3 id="简单散点图"><a href="#简单散点图" class="headerlink" title="简单散点图"></a>简单散点图</h3><p>效果图<br><img src="https://img-blog.csdnimg.cn/20200317153848740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>数据来自：<a target="_blank" rel="noopener" href="https://www.worldbank.org/">https://www.worldbank.org/</a></p>
<p>完整代码（不含Initialize初始化数据的函数）：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    w *= <span class="number">0.98</span>;</span><br><span class="line">    h *= <span class="number">0.9</span>;</span><br><span class="line">    <span class="keyword">let</span> T = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> NAME = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> RANGE = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> Data = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="comment">// [1] -&gt; population of age range 0~14</span></span><br><span class="line">    <span class="comment">// [2] -&gt; population of age range 15~64</span></span><br><span class="line">    <span class="comment">// [3] -&gt; population of age range 65+</span></span><br><span class="line"></span><br><span class="line">    initialize();</span><br><span class="line">    <span class="comment">//初始化数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内部空间</span></span><br><span class="line">    <span class="keyword">let</span> inner = &#123;<span class="attr">top</span>: <span class="number">50</span>, <span class="attr">right</span>: <span class="number">50</span>, <span class="attr">bottom</span>: <span class="number">50</span>, <span class="attr">left</span>: <span class="number">50</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 坐标轴的定义</span></span><br><span class="line">    <span class="keyword">let</span> xScale = d3.scaleLinear()</span><br><span class="line">        .domain([<span class="number">1960</span>, <span class="number">2018</span>])</span><br><span class="line">        .range([<span class="number">0</span>, w - inner.left - inner.right])</span><br><span class="line">        .nice();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> xAxis = d3.axisBottom(xScale);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> yScale = d3.scaleLinear()</span><br><span class="line">        .domain([<span class="number">0</span>, <span class="number">100</span>])</span><br><span class="line">        .range([h - inner.top - inner.bottom, <span class="number">0</span>])</span><br><span class="line">        .nice();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> yAxis = d3.axisLeft(yScale);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> svg = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, w)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, h)</span><br><span class="line">        .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">    svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (h - inner.bottom) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">        .call(xAxis);</span><br><span class="line"></span><br><span class="line">    svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (inner.top) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">        .call(yAxis);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重画某一条线上的数据</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params">v, t</span>) </span>&#123;</span><br><span class="line">        svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .data(Data[t])</span><br><span class="line">            .enter()</span><br><span class="line">            .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (d[<span class="number">0</span>] === v) <span class="keyword">return</span> T[d[<span class="number">0</span>] - <span class="number">1</span>];</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (d[<span class="number">0</span>] === v) <span class="keyword">return</span> inner.left + xScale(d[<span class="number">1</span>]);</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (d[<span class="number">0</span>] === v) <span class="keyword">return</span> inner.top + yScale(d[<span class="number">2</span>]);</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;r&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据点击次数处理效果</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">FF</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        svg.selectAll(<span class="string">&quot;circle&quot;</span>).remove();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">1</span>; k &lt;= <span class="number">3</span>; ++k) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">13</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cnt[i] &gt; <span class="number">0</span> &amp;&amp; cnt[i] % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ct[k] &gt; <span class="number">0</span> &amp;&amp; ct[k] % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                        F(i, k);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义可选的国家的方块</span></span><br><span class="line">    <span class="keyword">let</span> svg2 = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="number">500</span>)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> cnt = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> ct = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">13</span>; ++i) &#123;</span><br><span class="line">        cnt[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; ++i) ct[i] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    svg2.selectAll(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .data(NAME)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> i * <span class="number">20</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> T[i];</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            cnt[i + <span class="number">1</span>]++;</span><br><span class="line">            FF();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    svg2.selectAll(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .data(NAME)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + (<span class="number">40</span>) + <span class="string">&quot;,&quot;</span> + (i * <span class="number">20</span> + <span class="number">15</span>) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;font-size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">        .text(<span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> NAME[i];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义选择的数据种类的方块</span></span><br><span class="line">    <span class="keyword">let</span> svg3 = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="number">500</span>)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    svg3.selectAll(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .data(RANGE)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">40</span> * i + <span class="number">5</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br><span class="line">        .on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            ct[i + <span class="number">1</span>]++;</span><br><span class="line">            FF();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    svg3.selectAll(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .data(RANGE)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + (i * <span class="number">40</span> + <span class="number">15</span>) + <span class="string">&quot;,&quot;</span> + (<span class="number">60</span>) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;font-size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">        .text(<span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> RANGE[i];</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>代码解释：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line"><span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">w *= <span class="number">0.98</span>;</span><br><span class="line">h *= <span class="number">0.9</span>;</span><br></pre></td></tr></table></figure>
<p>获得网页页面上的可视区域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 坐标轴的定义</span></span><br><span class="line"><span class="keyword">let</span> xScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">1960</span>, <span class="number">2018</span>])</span><br><span class="line">    .range([<span class="number">0</span>, w - inner.left - inner.right])</span><br><span class="line">    .nice();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xAxis = d3.axisBottom(xScale);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> yScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, <span class="number">100</span>])</span><br><span class="line">    .range([h - inner.top - inner.bottom, <span class="number">0</span>])</span><br><span class="line">    .nice();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> yAxis = d3.axisLeft(yScale);</span><br></pre></td></tr></table></figure>
<p>domain即值域，表示数据的范围。其中的数据可以是一个区间，也可以是一个数组，可以是离散的数据。<br>range即映射范围，设置刻度的输出范围值的指定数组。<br>nice修改规模域，使边界延伸到最近的整数值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重画某一条线上的数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params">v, t</span>) </span>&#123;</span><br><span class="line">    svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">        .data(Data[t])</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (d[<span class="number">0</span>] === v) <span class="keyword">return</span> T[d[<span class="number">0</span>] - <span class="number">1</span>];</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (d[<span class="number">0</span>] === v) <span class="keyword">return</span> inner.left + xScale(d[<span class="number">1</span>]);</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (d[<span class="number">0</span>] === v) <span class="keyword">return</span> inner.top + yScale(d[<span class="number">2</span>]);</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;r&quot;</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以圆圈的形式绘制散点图。cx，cy表示坐标位置。r表示半径大小。<br>借助匿名函数来选择满足要求。</p>
<p>后面额外添加了两个画布，一个用来表示每个国家对应的颜色。颜色用矩形的形式呈现，后面添加文本。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">svg2.selectAll(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .data(NAME)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i * <span class="number">20</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;width&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    .attr(<span class="string">&quot;height&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> T[i];</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        cnt[i + <span class="number">1</span>]++;</span><br><span class="line">        FF();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>矩形设置了点击的事件处理，即点击该矩形后显示该国家的数据。</p>
<p>同时增添了一个svg3，用来选择呈现哪一部分的数据。</p>
<h3 id="平行坐标系"><a href="#平行坐标系" class="headerlink" title="平行坐标系"></a>平行坐标系</h3><p>平行坐标系的介绍：<a target="_blank" rel="noopener" href="http://www.zhaiqianfeng.com/2016/09/parallel-coordinates.html">http://www.zhaiqianfeng.com/2016/09/parallel-coordinates.html</a><br>数据来自：<a target="_blank" rel="noopener" href="https://www.worldbank.org/">https://www.worldbank.org/</a></p>
<p>平行坐标系是用来解决同时展示多个坐标轴的数据集的可视化问题。平行坐标系是被广泛使用的可视化技术之一，是分析多维数据的强有力的工具。</p>
<p>这里我在做的时候采用了最简单的方法制作的，即创建多个等长的比例尺，然后等距竖向排列在svg画布中，再用一条一条的折线将其连接起来。</p>
<p>效果图：<br><img src="https://img-blog.csdnimg.cn/20200317203945146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>各坐标轴所示数据分别为：国家id，年龄15 - 64人口比例，0 - 14人口比例，人均gdp，65+人口比例。<br>不同国家的数据用不同的颜色表示，左下角为不同国家的颜色对应。</p>
<p>代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    w *= <span class="number">0.98</span>;</span><br><span class="line">    h *= <span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> NAME = [<span class="string">&quot;id&quot;</span>, <span class="string">&quot;15-64(%)&quot;</span>, <span class="string">&quot;0-14(%)&quot;</span>, <span class="string">&quot;gdp($)&quot;</span>, <span class="string">&quot;65+(%)&quot;</span>];</span><br><span class="line">    <span class="keyword">let</span> inner = &#123;<span class="attr">top</span>: <span class="number">50</span>, <span class="attr">right</span>: <span class="number">50</span>, <span class="attr">bottom</span>: <span class="number">50</span>, <span class="attr">left</span>: <span class="number">50</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> Data = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> T = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> LineData = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> Scale = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> Axis = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> CNAME = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义所有坐标轴</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        Scale[i] = d3.scaleLinear();</span><br><span class="line">        <span class="keyword">if</span> (i === <span class="number">0</span>) Scale[i].domain([<span class="number">1</span>, <span class="number">13</span>]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (i != <span class="number">3</span>) Scale[i].domain([<span class="number">0</span>, <span class="number">100</span>]);</span><br><span class="line">        <span class="keyword">else</span> Scale[i].domain([<span class="number">0</span>, <span class="number">60000</span>]);</span><br><span class="line">        Scale[i].range([h - inner.top - inner.bottom, <span class="number">0</span>])</span><br><span class="line">            .nice();</span><br><span class="line">        Axis[i] = d3.axisLeft(Scale[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> svg = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, w)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, h)</span><br><span class="line">        .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">    svg.selectAll(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .data(NAME)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + (inner.left * <span class="number">0.7</span> + (w / <span class="number">6</span>) * i) + <span class="string">&quot;,&quot;</span> + (inner.top * <span class="number">0.7</span>) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;font-size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">        .text(<span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> NAME[i];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    initialize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连线</span></span><br><span class="line">    <span class="keyword">let</span> Line = d3.line()</span><br><span class="line">        .x(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> d.x;</span><br><span class="line">        &#125;)</span><br><span class="line">        .y(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> d.y;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> LineGraph = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">13</span>; ++i) &#123;</span><br><span class="line">        LineGraph[i] = svg.append(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;d&quot;</span>, Line(LineData[i]))</span><br><span class="line">            .attr(<span class="string">&quot;stroke&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> T[i];</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;stroke-width&quot;</span>, <span class="number">2</span>)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + (inner.left + (w / <span class="number">6</span>) * i) + <span class="string">&quot;,&quot;</span> + (inner.top) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">            .call(Axis[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义国家构成的方块以说明</span></span><br><span class="line">    <span class="keyword">let</span> svg2 = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="number">500</span>)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    svg2.selectAll(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .data(CNAME)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> i * <span class="number">20</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> T[i];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    svg2.selectAll(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .data(CNAME)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + (<span class="number">40</span>) + <span class="string">&quot;,&quot;</span> + (i * <span class="number">20</span> + <span class="number">15</span>) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;font-size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">        .text(<span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CNAME[i];</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>代码解释：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">svg.selectAll(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .data(NAME)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .attr(<span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + (inner.left * <span class="number">0.7</span> + (w / <span class="number">6</span>) * i) + <span class="string">&quot;,&quot;</span> + (inner.top * <span class="number">0.7</span>) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&quot;font-size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">    .text(<span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> NAME[i];</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>将名称设置到每个坐标轴的上方，transform可以将位置进行平移。<br>font-size设置字体大小。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Line = d3.line()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> d.x;</span><br><span class="line">    &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> d.y;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>首先创建直线生成器，就可将数据信息准换成svg路径信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> LineGraph = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">13</span>; ++i) &#123;</span><br><span class="line">    LineGraph[i] = svg.append(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;d&quot;</span>, Line(LineData[i]))</span><br><span class="line">        .attr(<span class="string">&quot;stroke&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> T[i];</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;stroke-width&quot;</span>, <span class="number">1</span>)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后是画线过程。stroke-with可以控制线的宽度。stroke控制线的颜色，T数组预先生成好rgba的颜色变量。</p>
<p>Initialize部分，即原始数据集以及画线的坐标处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        CNAME = [</span><br><span class="line">            <span class="string">&quot;Bangladesh&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Brazil&quot;</span>,</span><br><span class="line">            <span class="string">&quot;China&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Germany&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Indonesia&quot;</span>,</span><br><span class="line">            <span class="string">&quot;India&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Iran&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Japan&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Mexico&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Nigeria&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Pakistan&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Russian Federation&quot;</span>,</span><br><span class="line">            <span class="string">&quot;United States&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        Data = [</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">d2</span>: <span class="number">28.2246</span>, <span class="attr">d1</span>: <span class="number">66.6259</span>, <span class="attr">d3</span>: <span class="number">5.14948</span>, <span class="attr">d4</span>: <span class="number">1563.99</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">d2</span>: <span class="number">21.6838</span>, <span class="attr">d1</span>: <span class="number">69.7107</span>, <span class="attr">d3</span>: <span class="number">8.60549</span>, <span class="attr">d4</span>: <span class="number">9880.95</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">d2</span>: <span class="number">17.9374</span>, <span class="attr">d1</span>: <span class="number">71.7175</span>, <span class="attr">d3</span>: <span class="number">10.3451</span>, <span class="attr">d4</span>: <span class="number">8759.04</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">d2</span>: <span class="number">13.4507</span>, <span class="attr">d1</span>: <span class="number">65.1778</span>, <span class="attr">d3</span>: <span class="number">21.3715</span>, <span class="attr">d4</span>: <span class="number">44240</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">5</span>, <span class="attr">d2</span>: <span class="number">26.9149</span>, <span class="attr">d1</span>: <span class="number">67.4032</span>, <span class="attr">d3</span>: <span class="number">5.68195</span>, <span class="attr">d4</span>: <span class="number">3836.91</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">6</span>, <span class="attr">d2</span>: <span class="number">27.4787</span>, <span class="attr">d1</span>: <span class="number">66.5382</span>, <span class="attr">d3</span>: <span class="number">5.98311</span>, <span class="attr">d4</span>: <span class="number">1981.27</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">7</span>, <span class="attr">d2</span>: <span class="number">24.2478</span>, <span class="attr">d1</span>: <span class="number">69.7135</span>, <span class="attr">d3</span>: <span class="number">6.03871</span>, <span class="attr">d4</span>: <span class="number">5627.75</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">8</span>, <span class="attr">d2</span>: <span class="number">12.8144</span>, <span class="attr">d1</span>: <span class="number">60.0761</span>, <span class="attr">d3</span>: <span class="number">27.1095</span>, <span class="attr">d4</span>: <span class="number">38332</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">9</span>, <span class="attr">d2</span>: <span class="number">26.9392</span>, <span class="attr">d1</span>: <span class="number">66.02</span>, <span class="attr">d3</span>: <span class="number">7.04077</span>, <span class="attr">d4</span>: <span class="number">9278.42</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">10</span>, <span class="attr">d2</span>: <span class="number">44.0131</span>, <span class="attr">d1</span>: <span class="number">53.2377</span>, <span class="attr">d3</span>: <span class="number">2.74914</span>, <span class="attr">d4</span>: <span class="number">1968.56</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">11</span>, <span class="attr">d2</span>: <span class="number">35.4786</span>, <span class="attr">d1</span>: <span class="number">60.2075</span>, <span class="attr">d3</span>: <span class="number">4.31384</span>, <span class="attr">d4</span>: <span class="number">1464.99</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">12</span>, <span class="attr">d2</span>: <span class="number">17.634</span>, <span class="attr">d1</span>: <span class="number">68.1027</span>, <span class="attr">d3</span>: <span class="number">14.2633</span>, <span class="attr">d4</span>: <span class="number">10750.6</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">13</span>, <span class="attr">d2</span>: <span class="number">18.8585</span>, <span class="attr">d1</span>: <span class="number">65.7221</span>, <span class="attr">d3</span>: <span class="number">15.4194</span>, <span class="attr">d4</span>: <span class="number">59927.9</span>&#125;,];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">13</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> x = <span class="built_in">Math</span>.random() * <span class="number">256</span>;</span><br><span class="line">            <span class="keyword">let</span> y = <span class="built_in">Math</span>.random() * <span class="number">256</span>;</span><br><span class="line">            <span class="keyword">let</span> z = <span class="built_in">Math</span>.random() * <span class="number">256</span>;</span><br><span class="line">            T[i] = <span class="string">&#x27;rgba(&#x27;</span> + x + <span class="string">&#x27;,&#x27;</span> + y + <span class="string">&#x27;,&#x27;</span> + z + <span class="string">&#x27;,0.8)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> H = h - inner.top - inner.bottom;</span><br><span class="line">            LineData[i] = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">            LineData[i][<span class="number">0</span>] = &#123;<span class="string">&quot;x&quot;</span>: (inner.left + (w / <span class="number">6</span>) * <span class="number">0</span>), <span class="string">&quot;y&quot;</span>: (-inner.bottom + h - H * (Data[i].id - <span class="number">1</span>) / <span class="number">12</span>)&#125;;</span><br><span class="line">            LineData[i][<span class="number">1</span>] = &#123;<span class="string">&quot;x&quot;</span>: (inner.left + (w / <span class="number">6</span>) * <span class="number">1</span>), <span class="string">&quot;y&quot;</span>: (-inner.bottom + h - H * (Data[i].d1 - <span class="number">1</span>) / <span class="number">100</span>)&#125;;</span><br><span class="line">            LineData[i][<span class="number">2</span>] = &#123;<span class="string">&quot;x&quot;</span>: (inner.left + (w / <span class="number">6</span>) * <span class="number">2</span>), <span class="string">&quot;y&quot;</span>: (-inner.bottom + h - H * (Data[i].d2 - <span class="number">1</span>) / <span class="number">100</span>)&#125;;</span><br><span class="line">            LineData[i][<span class="number">3</span>] = &#123;<span class="string">&quot;x&quot;</span>: (inner.left + (w / <span class="number">6</span>) * <span class="number">3</span>), <span class="string">&quot;y&quot;</span>: (-inner.bottom + h - H * (Data[i].d4 - <span class="number">1</span>) / <span class="number">60000</span>)&#125;;</span><br><span class="line">            LineData[i][<span class="number">4</span>] = &#123;<span class="string">&quot;x&quot;</span>: (inner.left + (w / <span class="number">6</span>) * <span class="number">4</span>), <span class="string">&quot;y&quot;</span>: (-inner.bottom + h - H * (Data[i].d3 - <span class="number">1</span>) / <span class="number">100</span>)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>注意LineData数组存储的是每条线的节点信息，要注意计算清楚数据值占比例尺的比例以及应当平移的量，这里的svg画存在一个内部的空白框，画之前一定要确定清楚。</p>
<h3 id="箱型图（Boxplot）"><a href="#箱型图（Boxplot）" class="headerlink" title="箱型图（Boxplot）"></a>箱型图（Boxplot）</h3><p>箱型图概念解释：<a target="_blank" rel="noopener" href="https://blog.csdn.net/aijiudu/article/details/89387328">https://blog.csdn.net/aijiudu/article/details/89387328</a></p>
<p><img src="https://img-blog.csdnimg.cn/2020032610450325.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>箱型图，是一种用于显示一组数据分散情况资料的统计图，即每一个box表示的是一组数据。<br>通常采用五个数值来概括这一组数据，即：中位数$Q2$，下四分位数$Q1$，上四分位数$Q3$，上限和下限。<br>其中，$Q2=\left\{\begin{aligned}&amp;a_{(n+1)/2},odd\\&amp;\frac{a_{n/2}+a_{n/2+1}}{2},even \end{aligned}\right.$，$Q1=a_{\frac{1<em>(n+1)}{4}}$，$Q3=a_{\frac{3</em>(n+1)}{4}}$。$IQR=Q3-Q1$，上限为不超过$Q3+1.5<em>IQR$的最大值，下限为不低于$Q1-1.5</em>IQR$的最小值，超出上下限的数值均可看作异常值。</p>
<p>数据均来自网站：<br><a target="_blank" rel="noopener" href="https://github.com/pearmini/d3-barchart-demo?tdsourcetag=s_pctim_aiomsg">https://github.com/pearmini/d3-barchart-demo?tdsourcetag=s_pctim_aiomsg</a><br><a href="%E6%95%B0%E6%8D%AE%E5%9D%87%E6%9D%A5%E8%87%AA%E7%BD%91%E7%AB%99%EF%BC%9Ahttps://github.com/pearmini/d3-barchart-demo?tdsourcetag=s_pctim_aiomsg%20%EF%BC%8Chttps://github.com/datasets/population">https://github.com/datasets/population</a></p>
<p>效果图：<br><img src="https://img-blog.csdnimg.cn/20200326115058971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;BoxPlot&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onClick=<span class="string">&quot;display()&quot;</span>&gt;show&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;ID&quot;</span>&gt;</span><br><span class="line">    &lt;option value=<span class="string">&quot;0&quot;</span>&gt;Death(%)&lt;/option&gt;</span><br><span class="line">    &lt;option value=<span class="string">&quot;1&quot;</span>&gt;Cure(%)&lt;/option&gt;</span><br><span class="line">    &lt;option value=<span class="string">&quot;2&quot;</span>&gt;Rate(per <span class="number">10</span>,<span class="number">000</span>)&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    w *= <span class="number">0.98</span>;</span><br><span class="line">    h *= <span class="number">0.9</span>;</span><br><span class="line">    <span class="keyword">const</span> inf = <span class="number">1e9</span> + <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> inner = &#123;<span class="attr">top</span>: <span class="number">50</span>, <span class="attr">right</span>: <span class="number">50</span>, <span class="attr">bottom</span>: <span class="number">50</span>, <span class="attr">left</span>: <span class="number">50</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> W = w - inner.left - inner.right;</span><br><span class="line">    <span class="keyword">let</span> H = h - inner.top - inner.bottom;</span><br><span class="line">    <span class="keyword">let</span> Data = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    Initialize();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> x = <span class="built_in">document</span>.getElementById(<span class="string">&quot;ID&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> T = <span class="built_in">parseInt</span>(x.value);</span><br><span class="line">        <span class="keyword">let</span> DateData = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">let</span> NumData = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">let</span> Num = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">let</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//不同的选项，排序的优先级不同</span></span><br><span class="line">        Data.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> stra = <span class="keyword">new</span> <span class="built_in">Date</span>(a.date), strb = <span class="keyword">new</span> <span class="built_in">Date</span>(b.date);</span><br><span class="line">            <span class="keyword">if</span> (stra.getTime() === strb.getTime()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (T === <span class="number">0</span>) <span class="keyword">return</span> a.DeathRate - b.DeathRate;</span><br><span class="line">                <span class="keyword">if</span> (T === <span class="number">1</span>) <span class="keyword">return</span> a.CuredRate - b.CuredRate;</span><br><span class="line">                <span class="keyword">if</span> (T === <span class="number">2</span>) <span class="keyword">return</span> a.ComfirmedRate - b.ComfirmedRate;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">return</span> stra.getTime() - strb.getTime();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; Data.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">0</span> || Data[i].date !== Data[i - <span class="number">1</span>].date) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i !== <span class="number">0</span>) cnt++;</span><br><span class="line">                DateData[cnt] = <span class="keyword">new</span> <span class="built_in">Date</span>(Data[i].date);</span><br><span class="line">                NumData[cnt] = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (T === <span class="number">0</span>) NumData[cnt].push(Data[i].DeathRate);</span><br><span class="line">            <span class="keyword">if</span> (T === <span class="number">1</span>) NumData[cnt].push(Data[i].CuredRate);</span><br><span class="line">            <span class="keyword">if</span> (T === <span class="number">2</span>) NumData[cnt].push(Data[i].ComfirmedRate);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ++cnt;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算每组数据的Q1 Q2 Q3等</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cnt; ++i) &#123;</span><br><span class="line">            NumData[i].sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a - b;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">let</span> n = NumData[i].length;</span><br><span class="line">            <span class="keyword">let</span> Q1, Q2, Q3, U, D;</span><br><span class="line">            Q1 = NumData[i][<span class="built_in">Math</span>.round(n * <span class="number">0.25</span>)];</span><br><span class="line">            Q3 = NumData[i][<span class="built_in">Math</span>.round(n * <span class="number">0.75</span>)];</span><br><span class="line">            <span class="keyword">if</span> (n % <span class="number">2</span> === <span class="number">0</span>) Q2 = (NumData[i][<span class="built_in">Math</span>.ceil(n * <span class="number">0.5</span>)] + NumData[i][<span class="built_in">Math</span>.floor(n * <span class="number">0.5</span>)]) * <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">else</span> Q2 = NumData[i][<span class="built_in">Math</span>.round(n * <span class="number">0.5</span>)];</span><br><span class="line">            <span class="comment">// alert(Q2);</span></span><br><span class="line">            U = <span class="number">0</span>;</span><br><span class="line">            D = inf;</span><br><span class="line">            <span class="keyword">let</span> L = Q1 - <span class="number">1.5</span> * (Q3 - Q1);</span><br><span class="line">            <span class="keyword">let</span> R = Q3 + <span class="number">1.5</span> * (Q3 - Q1);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; NumData[i].length; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (NumData[i][j] &gt;= L &amp;&amp; NumData[i][j] &lt;= R) &#123;</span><br><span class="line">                    U = <span class="built_in">Math</span>.max(U, NumData[i][j]);</span><br><span class="line">                    D = <span class="built_in">Math</span>.min(D, NumData[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Num[i] = &#123;<span class="attr">Q1</span>: Q1, <span class="attr">Q2</span>: Q2, <span class="attr">Q3</span>: Q3, <span class="attr">U</span>: U, <span class="attr">D</span>: D&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(Num);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> xScale = d3.scaleTime()</span><br><span class="line">            .domain([DateData[<span class="number">0</span>], DateData[cnt - <span class="number">1</span>].setDate(DateData[cnt - <span class="number">1</span>].getDate() + <span class="number">1</span>)])</span><br><span class="line">            .range([<span class="number">0</span>, w - inner.left - inner.right]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> xAxis = d3.axisBottom(xScale).ticks(DateData.length);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> y1 = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (T === <span class="number">0</span>) y1 = <span class="number">50</span>;</span><br><span class="line">        <span class="keyword">if</span> (T === <span class="number">1</span>) y1 = <span class="number">50</span>;</span><br><span class="line">        <span class="keyword">if</span> (T === <span class="number">2</span>) y1 = <span class="number">3.5</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 横轴时间轴</span></span><br><span class="line">        <span class="keyword">let</span> yScale = d3.scaleLinear()</span><br><span class="line">            .domain([<span class="number">0</span>, y1])</span><br><span class="line">            .range([h - inner.top - inner.bottom, <span class="number">0</span>])</span><br><span class="line">            .nice();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> yAxis = d3.axisLeft(yScale);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> svg;</span><br><span class="line"></span><br><span class="line">        d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">            .selectAll(<span class="string">&quot;svg&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (d.id === <span class="string">&quot;123&quot;</span>) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .remove();</span><br><span class="line"></span><br><span class="line">        svg = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">            .append(<span class="string">&quot;svg&quot;</span>, id = <span class="string">&quot;123&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;width&quot;</span>, w)</span><br><span class="line">            .attr(<span class="string">&quot;height&quot;</span>, h)</span><br><span class="line">            .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">        svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (h - inner.bottom) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">            .call(xAxis.tickFormat(d3.timeFormat(<span class="string">&quot;%m-%d&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (inner.top) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">            .call(yAxis);</span><br><span class="line"></span><br><span class="line">        svg.selectAll(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .data(Num)</span><br><span class="line">            .enter()</span><br><span class="line">            .append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (i + <span class="number">0.2</span>) * (W / cnt) + inner.left;</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">let</span> tot = d.Q3 / y1 * H;</span><br><span class="line">                <span class="keyword">return</span> inner.top + (H - tot);</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> W / cnt * <span class="number">0.6</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;height&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (d.Q3 - d.Q1) / y1 * H</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&#x27;yellow&#x27;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;stroke&quot;</span>, <span class="string">&#x27;black&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 画线函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params">x1, y1, x2, y2, l = <span class="number">1</span>, c = <span class="string">&quot;black&quot;</span></span>) </span>&#123;</span><br><span class="line">            svg.append(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">                .attr(<span class="string">&quot;x1&quot;</span>, x1)</span><br><span class="line">                .attr(<span class="string">&quot;y1&quot;</span>, y1)</span><br><span class="line">                .attr(<span class="string">&quot;x2&quot;</span>, x2)</span><br><span class="line">                .attr(<span class="string">&quot;y2&quot;</span>, y2)</span><br><span class="line">                .attr(<span class="string">&quot;stroke-width&quot;</span>, l)</span><br><span class="line">                .attr(<span class="string">&quot;stroke&quot;</span>, c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cnt; ++i) &#123;</span><br><span class="line">            <span class="keyword">let</span> x1 = (i + <span class="number">0.2</span>) * (W / cnt) + inner.left;</span><br><span class="line">            <span class="keyword">let</span> x2 = x1 + (W / cnt) * <span class="number">0.6</span>;</span><br><span class="line">            <span class="keyword">let</span> y;</span><br><span class="line">            <span class="keyword">let</span> tot = Num[i].Q2 / y1 * H;</span><br><span class="line">            y = inner.top + (H - tot);</span><br><span class="line">            draw(x1, y, x2, y, <span class="number">2</span>);</span><br><span class="line">            tot = Num[i].U / y1 * H;</span><br><span class="line">            y = inner.top + (H - tot);</span><br><span class="line">            <span class="comment">// alert(y);</span></span><br><span class="line">            draw(x1, y, x2, y, <span class="number">1</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line">            draw((x1 + x2) * <span class="number">0.5</span>, inner.top + (H - Num[i].Q3 / y1 * H),</span><br><span class="line">                (x1 + x2) * <span class="number">0.5</span>, inner.top + (H - Num[i].U / y1 * H));</span><br><span class="line">            tot = Num[i].D / y1 * H;</span><br><span class="line">            y = inner.top + (H - tot);</span><br><span class="line">            draw(x1, y, x2, y);</span><br><span class="line">            draw((x1 + x2) * <span class="number">0.5</span>, inner.top + (H - Num[i].Q1 / y1 * H),</span><br><span class="line">                (x1 + x2) * <span class="number">0.5</span>, inner.top + (H - Num[i].D / y1 * H));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Initialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>代码中未包含Initialize初始化数据部分。</p>
<p>采用的一个矩形块+几条线段来确定每一个box。朴素实现该过程。</p>
<h3 id="折线统计图"><a href="#折线统计图" class="headerlink" title="折线统计图"></a>折线统计图</h3><p>数据来自csv文件。</p>
<p>绘制效果图：<br><img src="https://img-blog.csdnimg.cn/20200330152835192.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>图片一共由几个部分构成：</p>
<ol>
<li>横纵两个坐标轴，横轴为月份编号，纵轴是光照时间。</li>
<li>中间主体部分是折线，由svg的Path绘制，其中数据坐标点为svg的circle元素。</li>
<li>右上部分是图例，代表不同颜色代表的城市信息，城市纬度。颜色深浅程度代表纬度的高低。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造比例尺</span></span><br><span class="line">xScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">1</span>, <span class="number">12</span>])</span><br><span class="line">    .range([<span class="number">0</span>, w - inner.left - inner.right])</span><br><span class="line">    .nice();</span><br><span class="line"></span><br><span class="line">xAxis = d3.axisBottom(xScale);</span><br><span class="line"></span><br><span class="line">yScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, <span class="number">400</span>])</span><br><span class="line">    .range([h - inner.top - inner.bottom, <span class="number">0</span>])</span><br><span class="line">    .nice();</span><br><span class="line"></span><br><span class="line">yAxis = d3.axisLeft(yScale);</span><br></pre></td></tr></table></figure>
<p><code>绘制横轴和纵轴的构造</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解析csv数据</span></span><br><span class="line">d3.csv(<span class="string">&quot;sunshine.csv&quot;</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">    Data = d;</span><br><span class="line">    draw();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>解析csv数据，js的代码不是顺序执行的，而是异步的。在加载完csv文件后才去执行后面的内容，将解析后的数据放到d中作为参数来传递，此时d为数组元素。draw为后续的绘制操作。</code></p>
<p>完整代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    w *= <span class="number">0.98</span>;</span><br><span class="line">    h *= <span class="number">0.75</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> inner = &#123;<span class="attr">top</span>: <span class="number">50</span>, <span class="attr">right</span>: <span class="number">100</span>, <span class="attr">bottom</span>: <span class="number">50</span>, <span class="attr">left</span>: <span class="number">100</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> xScale, yScale;</span><br><span class="line">    <span class="keyword">let</span> xAxis, yAxis;</span><br><span class="line">    <span class="keyword">let</span> Data = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> svg = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, w)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, h)</span><br><span class="line">        .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造比例尺</span></span><br><span class="line">    xScale = d3.scaleLinear()</span><br><span class="line">        .domain([<span class="number">1</span>, <span class="number">12</span>])</span><br><span class="line">        .range([<span class="number">0</span>, w - inner.left - inner.right])</span><br><span class="line">        .nice();</span><br><span class="line"></span><br><span class="line">    xAxis = d3.axisBottom(xScale);</span><br><span class="line"></span><br><span class="line">    yScale = d3.scaleLinear()</span><br><span class="line">        .domain([<span class="number">0</span>, <span class="number">400</span>])</span><br><span class="line">        .range([h - inner.top - inner.bottom, <span class="number">0</span>])</span><br><span class="line">        .nice();</span><br><span class="line"></span><br><span class="line">    yAxis = d3.axisLeft(yScale);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析csv数据</span></span><br><span class="line">    d3.csv(<span class="string">&quot;sunshine.csv&quot;</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(d);</span><br><span class="line">        Data = d;</span><br><span class="line">        draw();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (h - inner.bottom) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">            .call(xAxis);</span><br><span class="line"></span><br><span class="line">        svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + inner.top + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">            .call(yAxis);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> Color = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">let</span> H = h - inner.top - inner.bottom;</span><br><span class="line">        <span class="keyword">let</span> LineData = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">let</span> City = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">let</span> ct = -<span class="number">1</span>, p = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 画线函数</span></span><br><span class="line">        <span class="keyword">let</span> Line = d3.line()</span><br><span class="line">            .x(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> d.x;</span><br><span class="line">            &#125;)</span><br><span class="line">            .y(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> d.y;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析数据,获取城市名称,生成颜色,构造折线数据等</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; Data.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">0</span> || Data[i].city !== Data[i - <span class="number">1</span>].city) &#123;</span><br><span class="line">                ++ct;</span><br><span class="line">                City[ct] = Data[i].city;</span><br><span class="line">                Color[ct] = <span class="string">&#x27;rgba(&#x27;</span> + (((ct + <span class="number">1</span>) / <span class="number">6</span>) * <span class="number">128</span>) + <span class="string">&#x27;,&#x27;</span> + (((ct + <span class="number">1</span>) / <span class="number">6</span>) * <span class="number">255</span>) + <span class="string">&#x27;,&#x27;</span> + <span class="number">255</span> + <span class="string">&#x27;,0.8)&#x27;</span>;</span><br><span class="line">                p = <span class="number">0</span>;</span><br><span class="line">                LineData[ct] = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            LineData[ct][p] = (&#123;</span><br><span class="line">                <span class="string">&quot;x&quot;</span>: (inner.left + ((w - inner.left - inner.right) / <span class="number">11</span>) * Data[i].monthnum),</span><br><span class="line">                <span class="string">&quot;y&quot;</span>: (-inner.bottom + h - H * (Data[i].sunshine) / <span class="number">400</span>)</span><br><span class="line">            &#125;);</span><br><span class="line">            ++p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// console.log(Color);</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= ct; ++i) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 绘制路径</span></span><br><span class="line">            svg.append(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">                .attr(<span class="string">&quot;d&quot;</span>, Line(LineData[i]))</span><br><span class="line">                .attr(<span class="string">&quot;stroke&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> Color[i];</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;stroke-width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">3.5</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 用圆圈标记每个点的位置</span></span><br><span class="line">            svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">                .selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">                .data(LineData[i])</span><br><span class="line">                .enter()</span><br><span class="line">                .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">                .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> Color[i];</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> d.x;</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> d.y;</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;r&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 画线段函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">drawLine</span>(<span class="params">x1, y1, x2, y2, l = <span class="number">1</span>, c = <span class="string">&quot;black&quot;</span></span>) </span>&#123;</span><br><span class="line">            svg.append(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">                .attr(<span class="string">&quot;x1&quot;</span>, x1)</span><br><span class="line">                .attr(<span class="string">&quot;y1&quot;</span>, y1)</span><br><span class="line">                .attr(<span class="string">&quot;x2&quot;</span>, x2)</span><br><span class="line">                .attr(<span class="string">&quot;y2&quot;</span>, y2)</span><br><span class="line">                .attr(<span class="string">&quot;stroke-width&quot;</span>, l)</span><br><span class="line">                .attr(<span class="string">&quot;stroke&quot;</span>, c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加文本的函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">drawText</span>(<span class="params">x, y, s, l = <span class="string">&#x27;12px&#x27;</span>, c = <span class="string">&#x27;black&#x27;</span></span>) </span>&#123;</span><br><span class="line">            svg.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">                .attr(<span class="string">&#x27;x&#x27;</span>, x)</span><br><span class="line">                .attr(<span class="string">&#x27;y&#x27;</span>, y)</span><br><span class="line">                .style(<span class="string">&#x27;fill&#x27;</span>, c)</span><br><span class="line">                .style(<span class="string">&#x27;font-size&#x27;</span>, l)</span><br><span class="line">                .text(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        drawText(w - inner.right * <span class="number">0.9</span>, h - inner.bottom * <span class="number">0.9</span>, <span class="string">&#x27;monthnum&#x27;</span>);</span><br><span class="line">        drawText(inner.left * <span class="number">0.75</span>, <span class="number">0.6</span> * inner.bottom, <span class="string">&#x27;sunshine&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右上角添加图例以及文字说明</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; ++i) &#123;</span><br><span class="line">            drawLine(w - inner.right - <span class="number">100</span>, inner.bottom + i * <span class="number">15</span>,</span><br><span class="line">                w - inner.right - <span class="number">50</span>, inner.bottom + i * <span class="number">15</span>, <span class="number">2</span>, Color[i]);</span><br><span class="line">            <span class="keyword">let</span> str;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">0</span>) str = <span class="number">47.61</span>;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">1</span>) str = <span class="number">41.88</span>;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">2</span>) str = <span class="number">40.73</span>;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">3</span>) str = <span class="number">37.73</span>;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">4</span>) str = <span class="number">29.74</span>;</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">5</span>) str = <span class="number">25.76</span>;</span><br><span class="line">            drawText(w - inner.right - <span class="number">40</span>, inner.bottom + i * <span class="number">15</span>, City[i] + <span class="string">&quot; / &quot;</span> + str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        drawText(w - inner.right - <span class="number">75</span>, <span class="number">0.5</span> * inner.bottom, <span class="string">&#x27;City/Latitude&#x27;</span>, <span class="string">&#x27;15px&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="动态条形图"><a href="#动态条形图" class="headerlink" title="动态条形图"></a>动态条形图</h3><p>数据来自csv文件。<br>绘制效果图：</p>
<p><img src="https://img-blog.csdnimg.cn/20200507154937467.gif#pic_center" alt="在这里插入图片描述"><br>数据集解释：数据信息为美国六个主要城市每个月的光照时间变化。</p>
<p>代码详细解释：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Color = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 随机生成每个城市的代表颜色</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i) &#123;</span><br><span class="line">        Color[i] = <span class="string">&#x27;rgba(&#x27;</span> + <span class="built_in">Math</span>.random() * <span class="number">255</span> + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">Math</span>.random() * <span class="number">255</span> + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">Math</span>.random() * <span class="number">255</span> + <span class="string">&#x27;,&#x27;</span> + <span class="number">0.8</span> + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>首先生成所有城市的颜色。所有颜色的rgb数值均随机生成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造比例尺</span></span><br><span class="line">   xScale = d3.scaleLinear()</span><br><span class="line">       .domain([<span class="number">0</span>, <span class="number">350</span>])</span><br><span class="line">       .range([<span class="number">0</span>, w - inner.left - inner.right])</span><br><span class="line">       .nice();</span><br><span class="line"></span><br><span class="line">   xAxis = d3.axisBottom(xScale);</span><br><span class="line"></span><br><span class="line">   svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">       .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (h - inner.bottom - <span class="number">40</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">       .call(xAxis);</span><br></pre></td></tr></table></figure>
<p>构造下方的比例尺。将比例尺平放放在底部。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解析csv数据</span></span><br><span class="line">    d3.csv(<span class="string">&quot;sunshine.csv&quot;</span>).then(function (d) &#123;</span><br><span class="line">        Data = d;</span><br><span class="line">        <span class="comment">// 首先按月份排序</span></span><br><span class="line">        Data.sort(function (a, b) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.monthnum - b.monthnum;</span><br><span class="line">        &#125;);</span><br><span class="line">        console.log(Data);</span><br><span class="line">        draw();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>解析csv数据。注意这个过程是异步的，接下来所进行的所有操作均在draw函数中执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//右下方数值，表示月份</span></span><br><span class="line">        <span class="keyword">let</span> comment = svg.append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, w - inner.right - inner.right)</span><br><span class="line">            .attr(<span class="string">&quot;y&quot;</span>, h - inner.bottom - inner.bottom - <span class="number">40</span>)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;black&quot;</span>)</span><br><span class="line">            .text(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Data[idx].month;</span><br><span class="line">            &#125;)</span><br><span class="line">            .style(<span class="string">&quot;font-size&quot;</span>, <span class="string">&quot;40&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>添加右下角的文本数据，表示当前状态所示的月份。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定该年的数据</span></span><br><span class="line">        <span class="keyword">const</span> groups = svg.selectAll(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .data(DataEntry).enter()</span><br><span class="line">            .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成标签和矩形</span></span><br><span class="line">        <span class="keyword">let</span> labels = groups.data(DataEntry)</span><br><span class="line">            .enter().append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .text(<span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> inner.left - <span class="number">10</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .style(<span class="string">&quot;font-size&quot;</span>, <span class="number">20</span>)</span><br><span class="line">            .attr(<span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;end&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> rects = groups.data(DataEntry)</span><br><span class="line">            .enter().append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, inner.left)</span><br><span class="line">            .attr(<span class="string">&quot;height&quot;</span>, H * <span class="number">0.65</span>)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Color[i];</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> xScale(d.sunshine);</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>
<p>数据主体部分，即表示数据的直方图以及数据旁边的城市名称。注意利用text-anchor来控制文本的对齐信息。此处为右对齐。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设定更新函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">UpdateElement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 通过data指定绑定的键值</span></span><br><span class="line">            labels.data(DataEntry, <span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">                .transition()</span><br><span class="line">                .duration(<span class="number">600</span>)</span><br><span class="line">                .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> i * H + inner.bottom + <span class="number">40</span>;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            rects.data(DataEntry, <span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">                .transition()</span><br><span class="line">                .duration(<span class="number">600</span>)</span><br><span class="line">                .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> i * H + inner.bottom;</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> xScale(d.sunshine);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>设定更新函数。<br>这里一定要注意，利用data来绑定更新数据，d =&gt; d.city为设置的绑定的键值。否则绑定其他信息会导致结果出错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> W = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i)</span><br><span class="line">                W.push(Data[t * <span class="number">6</span> + i]);</span><br><span class="line">            W.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> b.sunshine - a.sunshine;</span><br><span class="line">            &#125;);</span><br><span class="line">            DataEntry = W;</span><br><span class="line">            comment.text(DataEntry[<span class="number">0</span>].month);</span><br><span class="line">            UpdateElement();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用更新函数,每0.7s更新一次</span></span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            update((++idx) % <span class="number">12</span>);</span><br><span class="line">        &#125;, <span class="number">700</span>);</span><br></pre></td></tr></table></figure>
<p>设置更新函数以及调用更新函数。</p>
<p>完整代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;<span class="number">7</span>&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> w = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> h = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    w *= <span class="number">0.98</span>;</span><br><span class="line">    h *= <span class="number">0.90</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> inner = &#123;<span class="attr">top</span>: <span class="number">100</span>, <span class="attr">right</span>: <span class="number">100</span>, <span class="attr">bottom</span>: <span class="number">50</span>, <span class="attr">left</span>: <span class="number">200</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> xScale, xAxis;</span><br><span class="line">    <span class="keyword">let</span> DataEntry = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> Data = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> H = (h - inner.bottom - inner.top) / <span class="number">6</span> * <span class="number">0.95</span>;</span><br><span class="line">    <span class="keyword">let</span> Color = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 随机生成每个城市的代表颜色</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i) &#123;</span><br><span class="line">        Color[i] = <span class="string">&#x27;rgba(&#x27;</span> + <span class="built_in">Math</span>.random() * <span class="number">255</span> + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">Math</span>.random() * <span class="number">255</span> + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">Math</span>.random() * <span class="number">255</span> + <span class="string">&#x27;,&#x27;</span> + <span class="number">0.8</span> + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加画布</span></span><br><span class="line">    <span class="keyword">let</span> svg = d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">        .append(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, w)</span><br><span class="line">        .attr(<span class="string">&quot;height&quot;</span>, h)</span><br><span class="line">        .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造比例尺</span></span><br><span class="line">    xScale = d3.scaleLinear()</span><br><span class="line">        .domain([<span class="number">0</span>, <span class="number">350</span>])</span><br><span class="line">        .range([<span class="number">0</span>, w - inner.left - inner.right])</span><br><span class="line">        .nice();</span><br><span class="line"></span><br><span class="line">    xAxis = d3.axisBottom(xScale);</span><br><span class="line"></span><br><span class="line">    svg.append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + inner.left + <span class="string">&quot;,&quot;</span> + (h - inner.bottom - <span class="number">40</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">        .call(xAxis);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 月份循环变量</span></span><br><span class="line">    <span class="keyword">let</span> idx = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析csv数据</span></span><br><span class="line">    d3.csv(<span class="string">&quot;sunshine.csv&quot;</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        Data = d;</span><br><span class="line">        <span class="comment">// 首先按月份排序</span></span><br><span class="line">        Data.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a.monthnum - b.monthnum;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(Data);</span><br><span class="line">        draw();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//右下方数值，表示月份</span></span><br><span class="line">        <span class="keyword">let</span> comment = svg.append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, w - inner.right - inner.right)</span><br><span class="line">            .attr(<span class="string">&quot;y&quot;</span>, h - inner.bottom - inner.bottom - <span class="number">40</span>)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;black&quot;</span>)</span><br><span class="line">            .text(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Data[idx].month;</span><br><span class="line">            &#125;)</span><br><span class="line">            .style(<span class="string">&quot;font-size&quot;</span>, <span class="string">&quot;40&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加该月份的所有的城市信息</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i)</span><br><span class="line">            DataEntry.push(Data[idx * <span class="number">6</span> + i]);</span><br><span class="line">        DataEntry.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> b.sunshine - a.sunshine;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// console.log(DataEntry);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定该年的数据</span></span><br><span class="line">        <span class="keyword">const</span> groups = svg.selectAll(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .data(DataEntry).enter()</span><br><span class="line">            .append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成标签和矩形</span></span><br><span class="line">        <span class="keyword">let</span> labels = groups.data(DataEntry)</span><br><span class="line">            .enter().append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .text(<span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> inner.left - <span class="number">10</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .style(<span class="string">&quot;font-size&quot;</span>, <span class="number">20</span>)</span><br><span class="line">            .attr(<span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;end&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> rects = groups.data(DataEntry)</span><br><span class="line">            .enter().append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .attr(<span class="string">&quot;x&quot;</span>, inner.left)</span><br><span class="line">            .attr(<span class="string">&quot;height&quot;</span>, H * <span class="number">0.65</span>)</span><br><span class="line">            .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Color[i];</span><br><span class="line">            &#125;)</span><br><span class="line">            .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> xScale(d.sunshine);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设定更新函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">UpdateElement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 通过data指定绑定的键值</span></span><br><span class="line">            labels.data(DataEntry, <span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">                .transition()</span><br><span class="line">                .duration(<span class="number">600</span>)</span><br><span class="line">                .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> i * H + inner.bottom + <span class="number">40</span>;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            rects.data(DataEntry, <span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">                .transition()</span><br><span class="line">                .duration(<span class="number">600</span>)</span><br><span class="line">                .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> i * H + inner.bottom;</span><br><span class="line">                &#125;)</span><br><span class="line">                .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> xScale(d.sunshine);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UpdateElement();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> W = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i)</span><br><span class="line">                W.push(Data[t * <span class="number">6</span> + i]);</span><br><span class="line">            W.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> b.sunshine - a.sunshine;</span><br><span class="line">            &#125;);</span><br><span class="line">            DataEntry = W;</span><br><span class="line">            comment.text(DataEntry[<span class="number">0</span>].month);</span><br><span class="line">            UpdateElement();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用更新函数,每0.7s更新一次</span></span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            update((++idx) % <span class="number">12</span>);</span><br><span class="line">        &#125;, <span class="number">700</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    svg.append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .text(<span class="string">&quot;Monthly Hours of Sunshine&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;x&quot;</span>, w / <span class="number">2</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y&quot;</span>, <span class="number">30</span>)</span><br><span class="line">        .style(<span class="string">&quot;font-size&quot;</span>, <span class="number">25</span>)</span><br><span class="line">        .attr(<span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span>);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>另附sunshine.csv中的数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">city,lon,lat,month,monthnum,sunshine</span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Jan,<span class="number">0</span>,<span class="number">69</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Feb,<span class="number">1</span>,<span class="number">108</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Mar,<span class="number">2</span>,<span class="number">178</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Apr,<span class="number">3</span>,<span class="number">207</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,May,<span class="number">4</span>,<span class="number">253</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Jun,<span class="number">5</span>,<span class="number">268</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Jul,<span class="number">6</span>,<span class="number">312</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Aug,<span class="number">7</span>,<span class="number">281</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Sep,<span class="number">8</span>,<span class="number">221</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Oct,<span class="number">9</span>,<span class="number">142</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Nov,<span class="number">10</span>,<span class="number">72</span></span><br><span class="line">Seattle,<span class="number">-122.335167</span>,<span class="number">47.608013</span>,Dec,<span class="number">11</span>,<span class="number">52</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Jan,<span class="number">0</span>,<span class="number">135</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Feb,<span class="number">1</span>,<span class="number">136</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Mar,<span class="number">2</span>,<span class="number">187</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Apr,<span class="number">3</span>,<span class="number">215</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,May,<span class="number">4</span>,<span class="number">281</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Jun,<span class="number">5</span>,<span class="number">311</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Jul,<span class="number">6</span>,<span class="number">318</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Aug,<span class="number">7</span>,<span class="number">283</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Sep,<span class="number">8</span>,<span class="number">226</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Oct,<span class="number">9</span>,<span class="number">193</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Nov,<span class="number">10</span>,<span class="number">113</span></span><br><span class="line">Chicago,<span class="number">-87.623177</span>,<span class="number">41.881832</span>,Dec,<span class="number">11</span>,<span class="number">106</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Jan,<span class="number">0</span>,<span class="number">154</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Feb,<span class="number">1</span>,<span class="number">171</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Mar,<span class="number">2</span>,<span class="number">213</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Apr,<span class="number">3</span>,<span class="number">237</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,May,<span class="number">4</span>,<span class="number">268</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Jun,<span class="number">5</span>,<span class="number">289</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Jul,<span class="number">6</span>,<span class="number">302</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Aug,<span class="number">7</span>,<span class="number">271</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Sep,<span class="number">8</span>,<span class="number">235</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Oct,<span class="number">9</span>,<span class="number">213</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Nov,<span class="number">10</span>,<span class="number">169</span></span><br><span class="line">New York,<span class="number">-73.935242</span>,<span class="number">40.73061</span>,Dec,<span class="number">11</span>,<span class="number">155</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Jan,<span class="number">0</span>,<span class="number">165</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Feb,<span class="number">1</span>,<span class="number">182</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Mar,<span class="number">2</span>,<span class="number">251</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Apr,<span class="number">3</span>,<span class="number">281</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,May,<span class="number">4</span>,<span class="number">314</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Jun,<span class="number">5</span>,<span class="number">330</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Jul,<span class="number">6</span>,<span class="number">300</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Aug,<span class="number">7</span>,<span class="number">272</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Sep,<span class="number">8</span>,<span class="number">267</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Oct,<span class="number">9</span>,<span class="number">243</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Nov,<span class="number">10</span>,<span class="number">189</span></span><br><span class="line">San Francisco,<span class="number">-122.446747</span>,<span class="number">37.733795</span>,Dec,<span class="number">11</span>,<span class="number">156</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Jan,<span class="number">0</span>,<span class="number">144</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Feb,<span class="number">1</span>,<span class="number">141</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Mar,<span class="number">2</span>,<span class="number">193</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Apr,<span class="number">3</span>,<span class="number">212</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,May,<span class="number">4</span>,<span class="number">266</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Jun,<span class="number">5</span>,<span class="number">298</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Jul,<span class="number">6</span>,<span class="number">294</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Aug,<span class="number">7</span>,<span class="number">281</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Sep,<span class="number">8</span>,<span class="number">238</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Oct,<span class="number">9</span>,<span class="number">239</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Nov,<span class="number">10</span>,<span class="number">181</span></span><br><span class="line">Houston,<span class="number">-95.358421</span>,<span class="number">29.749907</span>,Dec,<span class="number">11</span>,<span class="number">146</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Jan,<span class="number">0</span>,<span class="number">222</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Feb,<span class="number">1</span>,<span class="number">227</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Mar,<span class="number">2</span>,<span class="number">266</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Apr,<span class="number">3</span>,<span class="number">275</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,May,<span class="number">4</span>,<span class="number">280</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Jun,<span class="number">5</span>,<span class="number">251</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Jul,<span class="number">6</span>,<span class="number">267</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Aug,<span class="number">7</span>,<span class="number">263</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Sep,<span class="number">8</span>,<span class="number">216</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Oct,<span class="number">9</span>,<span class="number">215</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Nov,<span class="number">10</span>,<span class="number">212</span></span><br><span class="line">Miami,<span class="number">-80.191788</span>,<span class="number">25.761681</span>,Dec,<span class="number">11</span>,<span class="number">209</span></span><br></pre></td></tr></table></figure>
<h3 id="动态图原理"><a href="#动态图原理" class="headerlink" title="动态图原理"></a>动态图原理</h3><h4 id="1-再谈“数据绑定”"><a href="#1-再谈“数据绑定”" class="headerlink" title="1. 再谈“数据绑定”"></a>1. 再谈“数据绑定”</h4><h5 id="1-1-选择元素"><a href="#1-1-选择元素" class="headerlink" title="1.1 选择元素"></a>1.1 选择元素</h5><p>D3中，选择元素的函数有两个<code>select</code>和<code>selectAll</code>，两种方法都很常用，select返回匹配选择器的第一个元素，而selectAll返回匹配选择器的所有元素。<br>选择所需元素的方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">&quot;body&quot;</span>); <span class="comment">//选择body元素</span></span><br><span class="line">d3.select(<span class="string">&quot;#tp1&quot;</span>); <span class="comment">//选择id为tp1的元素</span></span><br><span class="line">d3.select(<span class="string">&quot;.tp2&quot;</span>); <span class="comment">//选择类为tp2的元素</span></span><br></pre></td></tr></table></figure></p>
<p>当然，也可以对选择集中的元素再进行选择：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">  .selectAll(<span class="string">&quot;p&quot;</span>);</span><br></pre></td></tr></table></figure></p>
<h5 id="1-2-添加、插入和删除"><a href="#1-2-添加、插入和删除" class="headerlink" title="1.2 添加、插入和删除"></a>1.2 添加、插入和删除</h5><p><code>d3.select</code> 和 <code>d3.selectAll</code>所返回的对象称为选择集 <b>selection</b>。<br>利用 <strong>selection.attr(name,[])</strong> 来设置或获取选择集的属性。<br>利用 <strong>selection.text([])</strong> 设定或获取选择集的文本内容。</p>
<p>添加元素的方法为 <strong>selection.append(name)</strong> ，在选择集的末尾添加一个元素，name为元素的名称。<br>插入元素的方法为 <strong>selection.insert(name, [before])</strong> ，name是插入元素的名称，before为CSS选择器的名称，将元素插入到指定元素<strong>之前</strong>。</p>
<p>删除选择集中的元素 <strong>selection.remove()</strong> 。</p>
<h5 id="1-3-数据绑定"><a href="#1-3-数据绑定" class="headerlink" title="1.3 数据绑定"></a>1.3 数据绑定</h5><p>对于<code>d3.select</code> 和 <code>d3.selectAll</code> 返回的选择集是没有数据的。数据绑定的过程就是让这些被选择的元素中 “含有” 数据。</p>
<p><code>selection.datum(value)</code><br>选择集中的每个元素都绑定相同的数据value。<br><code>selection.data(values, [key])</code><br>选择集中的每一个元素分别绑定数组values中的每一项，key为键值函数，用于指定绑定时的对应规则。</p>
<p>在data绑定之后，有三种情况，分别按驻足长度和元素数量的关系如下：</p>
<ul>
<li>update 数组长度 = 元素数量</li>
<li>enter 数组元素 &gt; 元素数量</li>
<li>exit 数组元素 &lt; 元素数量<br><img src="https://img-blog.csdnimg.cn/20200602153939720.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>通常比较常用的方法是利用selectAll选取一个空集，随后再对enter() 部分添加元素append，即</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">  .data(d)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&quot;p&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>键函数key：</strong><br><strong>只有在选择集原来已经有数据的情况下，使用键函数才有效果！</strong><br>比如有如下内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://d3js.org/d3.v5.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> Data = [&#123;<span class="attr">name</span>: <span class="string">&quot;p1&quot;</span>, <span class="attr">data</span>: <span class="number">12</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;p2&quot;</span>, <span class="attr">data</span>: <span class="number">17</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;p3&quot;</span>, <span class="attr">data</span>: <span class="number">14</span>&#125;];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> p = d3.select(<span class="string">&quot;body&quot;</span>).selectAll(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">        .data(Data)</span><br><span class="line">        .text(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> d.name + <span class="string">&#x27;:&#x27;</span> + d.data;</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>此时p中数据显示为：<br><img src="https://img-blog.csdnimg.cn/20200602155219730.png" alt="在这里插入图片描述"><br>随后对数据进行更新：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> DataEntry = [&#123;<span class="attr">name</span>: <span class="string">&quot;p5&quot;</span>, <span class="attr">data</span>: <span class="number">17</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;p4&quot;</span>, <span class="attr">data</span>: <span class="number">14</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;p6&quot;</span>, <span class="attr">data</span>: <span class="number">12</span>&#125;];</span><br><span class="line"></span><br><span class="line">p.data(DataEntry, <span class="function"><span class="params">d</span> =&gt;</span> d.data)</span><br><span class="line">    .text(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> d.name + <span class="string">&#x27;:&#x27;</span> + d.data;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>可以看到此时p中的元素变为：<br><img src="https://img-blog.csdnimg.cn/20200602155529211.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>可以看到data作为键值，并没有按照DataEntry中的顺序进行依次绑定，而是保持原本顺序不变，<strong>使键值对应的数据作出更新</strong>。可以利用这一性质在制作动态图时更新数据。</p>
<h4 id="2-过渡效果"><a href="#2-过渡效果" class="headerlink" title="2. 过渡效果"></a>2. 过渡效果</h4><h5 id="2-1-过渡启动"><a href="#2-1-过渡启动" class="headerlink" title="2.1 过渡启动"></a>2.1 过渡启动</h5><p><code>d3.transition()</code> 创建一个过渡效果。对于每个选择集都可以使用<strong>transition()</strong>方法创建过渡。<br><code>transition.delay([value])</code> 设定延迟时间。过渡经过一段时间后才发生，单位是毫秒。<br><code>transition.duration([value])</code> 设定过渡的持续时间。单位为毫秒。<br>默认情况下，如果不设置时间的话delay为0ms，duration为250ms。<br><code>transition.ease(value,[])</code> 设定过渡样式、在目标处弹跳几次等方式。</p>
<h5 id="2-2-过渡属性"><a href="#2-2-过渡属性" class="headerlink" title="2.2 过渡属性"></a>2.2 过渡属性</h5><p>过渡前后的状态不同，因此需要指定过渡前后元素的不同属性。<br><code>transition.attr(name,value)</code> 属性name过渡到目标值value，value可以是一个函数。<br>例如如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&quot;r&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br><span class="line">.transition()</span><br><span class="line">.delay(<span class="number">3000</span>)</span><br><span class="line">.duration(<span class="number">2000</span>)</span><br><span class="line">.attr(<span class="string">&quot;r&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>transition.attrTween(name, tween())</code> 将属性 name 使用差值函数 tween() 。<br>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svg.transition()</span><br><span class="line">    .duration(<span class="number">2000</span>)</span><br><span class="line">    .attrTween(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d,i,a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">parseInt</span>(a + t * <span class="number">300</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>d是被绑定的数据，i是索引号，a是width的属性初始值。</p>
<h4 id="3-定时器"><a href="#3-定时器" class="headerlink" title="3. 定时器"></a>3. 定时器</h4><p><code>setInterval(code, millisec)</code> 以指定的周期来执行代码，直到 <code>clearInterval()</code> 被调用或者窗口被关闭。<br>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用更新函数,每0.7s更新一次</span></span><br><span class="line">   <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       update((++idx) % <span class="number">12</span>);</span><br><span class="line">   &#125;, <span class="number">700</span>);</span><br></pre></td></tr></table></figure>
<p>删除方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">let</span> id = <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       update((++idx) % <span class="number">12</span>);</span><br><span class="line">   &#125;, <span class="number">700</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="built_in">clearInterval</span>(id);</span><br></pre></td></tr></table></figure>
<h4 id="4-简单动画制作"><a href="#4-简单动画制作" class="headerlink" title="4. 简单动画制作"></a>4. 简单动画制作</h4><h5 id="4-1-动态绘制circle"><a href="#4-1-动态绘制circle" class="headerlink" title="4.1 动态绘制circle"></a>4.1 动态绘制circle</h5><p>效果图（含实时更新的情况）：<br><img src="https://img-blog.csdnimg.cn/20200602171212920.gif#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> circles = svg.selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .data(DataLine)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .attr(<span class="string">&quot;r&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> w - inner.right - (d.longitude * (-<span class="number">1</span>) - <span class="number">60</span>) / <span class="number">70</span> * W;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> h - inner.bottom - (d.latitude - <span class="number">25</span>) / <span class="number">30</span> * H;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">circles.transition()</span><br><span class="line">    .delay(<span class="number">3000</span>)</span><br><span class="line">    .duration(<span class="number">2000</span>)</span><br><span class="line">    .attr(<span class="string">&quot;r&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> d.PRCP * <span class="number">5</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;rgba(0,&#x27;</span> + <span class="built_in">Math</span>.max(<span class="number">0</span>, (<span class="number">175</span> - <span class="built_in">parseInt</span>(d.WSF5))) + <span class="string">&#x27;,&#x27;</span> + (<span class="number">255</span>) + <span class="string">&#x27;,0.8)&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    add1day(); <span class="comment">//更新idx的函数</span></span><br><span class="line">    update(idx);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">    comment.text(idx);</span><br><span class="line">    updateElement();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateElement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    svg.selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">        .data(DataEntry[sce], <span class="function"><span class="params">d</span> =&gt;</span> d.station)</span><br><span class="line">        .transition()</span><br><span class="line">        .duration(<span class="number">2000</span>)</span><br><span class="line">        .attr(<span class="string">&quot;r&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> d.PRCP * <span class="number">5</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;rgba(0,&#x27;</span> + <span class="built_in">Math</span>.max(<span class="number">0</span>, (<span class="number">175</span> - <span class="built_in">parseInt</span>(d.WSF5))) + <span class="string">&#x27;,&#x27;</span> + (<span class="number">255</span>) + <span class="string">&#x27;,0.8)&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-2-动态绘制rect"><a href="#4-2-动态绘制rect" class="headerlink" title="4.2 动态绘制rect"></a>4.2 动态绘制rect</h5><p><img src="https://img-blog.csdnimg.cn/20200602171713162.gif#pic_center" alt="在这里插入图片描述"></p>
<p>动态条形图代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rects = groups.data(DataEntry)</span><br><span class="line">    .enter().append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .attr(<span class="string">&quot;x&quot;</span>, inner.left)</span><br><span class="line">    .attr(<span class="string">&quot;height&quot;</span>, H * <span class="number">0.65</span>)</span><br><span class="line">    .attr(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Color[i];</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> xScale(d.sunshine);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 设定更新函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UpdateElement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    rects.data(DataEntry, <span class="function"><span class="params">d</span> =&gt;</span> d.city)</span><br><span class="line">        .transition()</span><br><span class="line">        .duration(<span class="number">600</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> i * H + inner.bottom;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;width&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> xScale(d.sunshine);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UpdateElement();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">    comment.text(DataEntry[<span class="number">0</span>].month);</span><br><span class="line">    UpdateElement();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用更新函数,每0.7s更新一次</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    update((++idx) % <span class="number">12</span>);</span><br><span class="line">&#125;, <span class="number">700</span>);</span><br></pre></td></tr></table></figure>
<h3 id="中国地图"><a href="#中国地图" class="headerlink" title="中国地图"></a>中国地图</h3><p>分享json数据来源：<a target="_blank" rel="noopener" href="http://datav.aliyun.com/tools/atlas/#&amp;lat=31.769817845138945&amp;lng=104.29901249999999&amp;zoom=4">http://datav.aliyun.com/tools/atlas/#&amp;lat=31.769817845138945&amp;lng=104.29901249999999&amp;zoom=4</a><br>D3基于D3.v5实现。<br>效果图：</p>
<p><img src="https://img-blog.csdnimg.cn/20200605144740776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vb25fc2t5MTk5OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>首先，定义地图的投影和地理路径生成器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> projection = d3.geoMercator()</span><br><span class="line">    .center([<span class="number">107</span>, <span class="number">31</span>])</span><br><span class="line">    .scale(h * <span class="number">0.9</span>)</span><br><span class="line">    .translate([w / <span class="number">2</span>, h / <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = d3.geoPath()</span><br><span class="line">    .projection(projection);</span><br></pre></td></tr></table></figure>
<p>Mercator为一种常用的投影方法墨卡托投影。center设定地图的中心位置，经度与纬度。scale和translate分别设置所放量和平移量。geoPath中应用次投影函数，才产生路径值。<br>利用d3.json请求geojson文件，添加足够数量的\<path\>，每一个path用于绘制每个省的路径。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">d3.json(<span class="string">&quot;ChinaMap.json&quot;</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">geo</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(geo);</span><br><span class="line">    <span class="keyword">let</span> Province = SvgMap.selectAll(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .data(geo.features)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;province&quot;</span>).style(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;rgba(0,&#x27;</span> + <span class="built_in">parseFloat</span>(<span class="number">255</span> - <span class="built_in">Math</span>.random() * <span class="number">50</span>) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">parseFloat</span>(<span class="number">255</span> - <span class="built_in">Math</span>.random() * <span class="number">100</span>) + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .attr(<span class="string">&quot;d&quot;</span>, path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意该过程是异步的。<br>数据解析后的绘制过程应该完全在解析之后，通常可以直接将代码写到then之后的函数之中。<br>color为颜色比例尺，可以提前构造生成，也可随机数驱动或数据驱动。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> color = d3.scaleOrdinal(d3.schemeCategory10);</span><br></pre></td></tr></table></figure>
<h2 id="学习网站"><a href="#学习网站" class="headerlink" title="学习网站"></a>学习网站</h2><h3 id="可视化作品"><a href="#可视化作品" class="headerlink" title="可视化作品"></a>可视化作品</h3><p><a target="_blank" rel="noopener" href="https://www.gapminder.org/">https://www.gapminder.org/</a></p>
<p>多个维度展示整个世界。世界人民生活质量、收入、人口，不同国家和地区，不同年份的变化。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xiaoq-sd.github.io/2021/04/23/data-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/yjq.jpg">
      <meta itemprop="name" content="Yang Jiaqi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoQ's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/23/data-structure/" class="post-title-link" itemprop="url">《数据结构》 课程笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-04-23 14:23:12 / 修改时间：20:52:24" itemprop="dateCreated datePublished" datetime="2021-04-23T14:23:12+08:00">2021-04-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考书目主要为 王道考研系列的《数据结构》。该系列为本人准备考研时所整理。 描述语言为C语言，部分代码采用了C++风格的描述方式。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/23/data-structure/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xiaoq-sd.github.io/2021/04/20/ACM-templates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/yjq.jpg">
      <meta itemprop="name" content="Yang Jiaqi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoQ's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/20/ACM-templates/" class="post-title-link" itemprop="url">ACM 模板整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-20 21:14:07" itemprop="dateCreated datePublished" datetime="2021-04-20T21:14:07+08:00">2021-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 18:59:07" itemprop="dateModified" datetime="2021-04-22T18:59:07+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文包含2017 - 2020 ACM竞赛期间的算法整理。</p>
<p>内容包括：</p>
<ol>
<li>Java &amp; C++</li>
<li>数学</li>
<li>图论</li>
<li>数据结构</li>
<li>动态规划</li>
<li>其它问题</li>
<li>组合数学</li>
<li>博弈问题</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/20/ACM-templates/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xiaoq-sd.github.io/2021/04/16/direction-for-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/yjq.jpg">
      <meta itemprop="name" content="Yang Jiaqi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoQ's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/16/direction-for-use/" class="post-title-link" itemprop="url">Hexo基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-16 15:06:30" itemprop="dateCreated datePublished" datetime="2021-04-16T15:06:30+08:00">2021-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-02 19:59:40" itemprop="dateModified" datetime="2021-05-02T19:59:40+08:00">2021-05-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> Hexo基础命令。常用功能的添加与修改等内容。</p>
<p>博客入门期间所整理。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/16/direction-for-use/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yang Jiaqi"
      src="/images/yjq.jpg">
  <p class="site-author-name" itemprop="name">Yang Jiaqi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yang Jiaqi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
